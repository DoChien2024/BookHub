<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Đổi mật khẩu</title>
    <link rel="stylesheet" th:href="@{/css/argon-lite.css}" href="/css/argon-lite.css">
</head>
<body class="shell">
<h2>Đổi mật khẩu</h2>
<form onsubmit="return false;" class="card panel">
    <label>Mật khẩu cũ <input id="old" type="password"></label>
    <label>Mật khẩu mới <input id="neo" type="password"></label>
    <div class="chips">
        <div class="chip primary" id="doChange">Đổi mật khẩu</div>
        <a class="chip" href="/">Về trang chính</a>
    </div>
</form>
<div id="toastContainer"></div>
<script src="/js/auth.js"></script>
<script>
    document.getElementById('doChange').onclick = async () => {
        const oldPassword = document.getElementById('old').value;
        const newPassword = document.getElementById('neo').value;
        const r = await fetch('/api/auth/change-password', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({oldPassword, newPassword}),
            credentials: 'include'
        });
        if (r.ok) { toast('Đổi mật khẩu thành công'); location.href='/'; }
        else      { const t = await r.text(); toast('Đổi mật khẩu lỗi', false); console.log(t); }
    }
</script>
</body>
</html>
